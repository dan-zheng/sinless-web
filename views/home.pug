extends layout

block content
    if !user
        div.main.unauth
            h1 Become a 
                span.emph better
                |  person.
            hr
            p We help you get rid of bad habits and develop good ones.
            a.btn.btn-primary(href='/login', role='button') Start today
    else
        div.main.auth
            if user.profile.firstName
                h1 Welcome to your dashboard, #{user.profile.firstName}!
                hr
                .row
                    .col-sm-6
                        h2 Balance Info
                        if user.account.balance > 15
                            .form-inline.has-success
                                .input-group.input-group-lg.bold
                                    .input-group-addon $
                                    input.form-control.form-control-success(type='number', name='balance', id='balance', value=user.account.balance.toFixed(2), readonly)
                                h3.text-success Your balance is good!
                        else if user.account.balance > 0
                            .form-inline.has-warning
                                .input-group.input-group-lg.bold
                                    .input-group-addon $
                                    input.bold.form-control.form-control-warning(type='number', name='balance', id='balance', value=user.account.balance.toFixed(2), readonly)
                                h3.text-warning Your balance is almost empty.
                        else
                            .form-inline.has-danger
                                .input-group.input-group-lg.bold
                                    .input-group-addon $
                                    input.form-control.form-control-danger(type='number', name='balance', id='balance', value=user.account.balance.toFixed(2), readonly)
                                h3.text-danger Your balance is empty!
                    .col-sm-6
                        h2 Deposit Money
                        form.form-inline(action='/account/goals', method='POST')
                            input(type='hidden', name='dailySwearMax', value=user.account.dailySwearMax)
                            input(type='hidden', name='home', value="true")
                            .input-group.input-group-lg.bold
                                .input-group-addon $
                                input.form-control.form-control-success(type='number', name='deposit', id='deposit', step='0.01', min='0', value='0.00')
                                span.input-group-btn
                                    button.btn.btn.btn-primary(type='submit')
                                        i.fa.fa-thumbs-o-up
                .row
                    .col-sm-6
                        h2 Swearing Info
                            if user.data.length > 0
                                each entry in user.data
                                    h3= entry.date.format("MMM D, Y")
                                    each action in entry.actions
                                        p= action.time.format("h:m A")
                                            | : #{action.actionType}, 
                                            span.red.bold= '+' + action.amountDeducted
                            else
                                h3 There is no negative data! 
                                    .i.fa.fa-smile-o
                        #swear-chart

            else
                h1 Welcome!
    script.
        var user = !{JSON.stringify(user)};
        var data = user.data;
        if (data.length > 0) {
            var currMoment = moment();
            var startMoment = moment(data[data.length - 1].date);
            var len = currMoment.diff(startMoment, "days") + 1;
            if (len > 7) {
                len = 7;
            }

            var count = 0;
            var limit = ['limit'];
            var swears = [];
            var dates = [];
            for (var i = 0; i < len; i++) {
                limit.push(user.account.dailySwearMax);
            }
            for (var i = data.length - 1; i >= 0; i--) {
                console.log(data[i]);
                var diff = currMoment.diff(data[i].date, "days");
                swears.push(data[i].swearCount);
                dates.push(moment(data[i].date).format("MM-DD"));
                console.log("diff: " + diff);
            }
            swears.unshift('swears');
            dates.unshift('dates');

            var swearChart = c3.generate({
                bindto: '#swear-chart',
                title: {
                    text: 'Swearing vs Time'
                },
                data: {
                    x: 'dates',
                    xFormat: '%m-%d',
                    columns: [
                        dates,
                        limit,
                        swears
                    ],
                    types: {
                        limit: 'area-spline',
                        swears: 'area-spline' // 'line', 'spline', 'step', 'area', 'area-step' are also available to stack
                    },
                    colors: {
                        limit: '#d62728',
                        swears: '#ff7f0e'
                    },
                    labels: true
                },
                axis: {
                    x: {
                        type: 'timeseries',
                        tick: {
                            format: '%m-%d'
                        }
                    }
                }
            });
        }
